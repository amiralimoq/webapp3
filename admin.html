<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Admin Panel</title>
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <!-- CSS -->
    <link rel="stylesheet" href="menu.css">
    
    <style>
        /* --- استایل‌های اختصاصی جدید (Uber Eats Style Chips) --- */
        .chip-dropdown { position: relative; display: inline-block; }
        .chip-btn {
            background: #F0F0F0; border: none; padding: 8px 16px; border-radius: 20px;
            font-size: 13px; font-weight: 600; color: #333; cursor: pointer;
            display: flex; align-items: center; gap: 8px; transition: 0.2s;
        }
        .chip-btn:hover { background: #e0e0e0; }
        .chip-btn.active-chip { background: black; color: white; }
        
        .chip-menu {
            display: none; position: absolute; top: 110%; left: 0;
            background: white; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            width: 200px; padding: 10px; z-index: 100; border: 1px solid #eee;
        }
        .chip-menu.show { display: block; }
        
        .chip-option {
            display: flex; align-items: center; gap: 10px; padding: 8px;
            cursor: pointer; border-radius: 8px; font-size: 13px; color: #555;
        }
        .chip-option:hover { background: #f9f9f9; }
        .chip-option.selected { font-weight: bold; color: #FF724C; }
        
        /* Modal Profile */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content { background: white; padding: 30px; border-radius: 24px; width: 400px; }

        /* General Updates */
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .nav-tab { padding: 10px 20px; border-radius: 12px; background: white; cursor: pointer; font-size: 13px; font-weight: 600; color: #888; border: 1px solid #eee; transition: 0.3s; }
        .nav-tab.active-tab { background: #FF724C; color: white; border-color: #FF724C; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(255,114,76,0.2); }
        
        .content-section { display: none; }
        .content-section.active-section { display: block; }

        /* Reviews */
        .review-card { background: white; padding: 15px; border-radius: 16px; margin-bottom: 15px; border-bottom: 1px solid #f0f0f0; }
        .review-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .star-rating { color: #FFB100; }
        
        /* Working Hours Box */
        .wh-container { background: white; padding: 25px; border-radius: 20px; margin-top: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.03); }
        .wh-grid { display: flex; gap: 20px; flex-wrap: wrap; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="logo">Admin<span>Panel</span></div>
            <ul class="menu-list">
                <li class="menu-item active" data-target="dashboard"><i class="ri-dashboard-line"></i> Dashboard</li>
                <li class="menu-item" data-target="customers"><i class="ri-user-heart-line"></i> Customers</li> <!-- Renamed -->
                <li class="menu-item" data-target="sales"><i class="ri-bar-chart-grouped-line"></i> Sales</li> <!-- Renamed -->
                <li class="menu-item" data-target="users"><i class="ri-group-line"></i> Users Management</li> <!-- New -->
                <li class="menu-item" data-target="reviews"><i class="ri-star-smile-line"></i> Reviews</li> <!-- New -->
                <li class="menu-item" data-target="messages"><i class="ri-mail-line"></i> Messages</li>
                <li class="menu-item logout"><i class="ri-logout-box-r-line"></i> Logout</li>
            </ul>
        </aside>

        <main class="main-content">
            <header class="header">
                <div class="search-bar" style="opacity: 0;"></div>
                <div class="user-profile" id="profile-trigger" style="cursor: pointer;">
                    <span id="header-username">Admin</span>
                    <div class="user-img" style="background-image: url('https://i.pravatar.cc/150?img=12');"></div>
                </div>
            </header>

            <!-- SECTION 1: DASHBOARD -->
            <div id="dashboard" class="content-section active-section">
                <!-- تاریخ داینامیک -->
                <div class="section-title" id="dashboard-date-title">...</div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #E9FBF0; color: #2ECC71;"><i class="ri-shopping-basket-2-line"></i></div>
                        <div><div style="color: #888; font-size: 12px;">Total Orders (Month)</div><h3 id="month-orders">...</h3></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #FFF0EB; color: #FF724C;"><i class="ri-money-dollar-circle-line"></i></div>
                        <div><div style="color: #888; font-size: 12px;">Revenue (Month)</div><h3 id="month-revenue">...</h3></div>
                    </div>
                </div>

                <!-- Working Hours -->
                <div class="wh-container">
                    <div class="section-title"><i class="ri-time-line"></i> Working Hours Settings</div>
                    <div class="wh-grid">
                        <!-- Start Time Chip -->
                        <div class="chip-dropdown" id="chip-start-time">
                            <button class="chip-btn" onclick="toggleChip('start-time')">Start: <span class="val">08:00</span> <i class="ri-arrow-down-s-line"></i></button>
                            <div class="chip-menu" id="menu-start-time">
                                <!-- Options generated by JS -->
                            </div>
                        </div>
                        
                        <!-- End Time Chip -->
                        <div class="chip-dropdown" id="chip-end-time">
                            <button class="chip-btn" onclick="toggleChip('end-time')">End: <span class="val">23:00</span> <i class="ri-arrow-down-s-line"></i></button>
                            <div class="chip-menu" id="menu-end-time"></div>
                        </div>

                        <!-- Start Day Chip -->
                        <div class="chip-dropdown" id="chip-start-day">
                            <button class="chip-btn" onclick="toggleChip('start-day')">Day: <span class="val">Monday</span> <i class="ri-arrow-down-s-line"></i></button>
                            <div class="chip-menu" id="menu-start-day"></div>
                        </div>

                         <!-- End Day Chip -->
                         <div class="chip-dropdown" id="chip-end-day">
                            <button class="chip-btn" onclick="toggleChip('end-day')">To: <span class="val">Sunday</span> <i class="ri-arrow-down-s-line"></i></button>
                            <div class="chip-menu" id="menu-end-day"></div>
                        </div>
                        
                        <button class="btn-add" id="save-wh-btn" style="margin-left:auto;">Save Changes</button>
                    </div>
                </div>
            </div>

            <!-- SECTION 2: CUSTOMERS -->
            <div id="customers" class="content-section">
                <div class="section-title"><i class="ri-user-heart-line"></i> Customers</div>
                
                <div class="nav-tabs">
                    <div class="nav-tab active-tab" onclick="switchCustomerTab('all', this)">All Customers</div>
                    <div class="nav-tab" onclick="switchCustomerTab('loyal', this)">Loyal (>3 Orders)</div>
                    <div class="nav-tab" onclick="switchCustomerTab('valuable', this)">Most Valuable (1 Yr)</div>
                    <div class="nav-tab" onclick="switchCustomerTab('interests', this)">Interests</div>
                </div>

                <div class="data-table">
                    <div class="list-row list-header" id="customer-header">
                        <!-- Dynamic Header -->
                    </div>
                    <div id="customer-list"></div>
                </div>
            </div>

            <!-- SECTION 3: SALES -->
            <div id="sales" class="content-section">
                <div class="section-title"><i class="ri-bar-chart-grouped-line"></i> Sales Analytics</div>

                <!-- Main Sales Tabs -->
                <div class="nav-tabs">
                    <div class="nav-tab active-tab" onclick="switchSalesMode('cash', this)">Cash Report</div>
                    <div class="nav-tab" onclick="switchSalesMode('product', this)">Product Report</div>
                </div>

                <!-- CASH REPORT VIEW -->
                <div id="sales-cash-view">
                    <!-- Filters -->
                     <div class="nav-tabs" style="margin-top: 15px;">
                        <div class="nav-tab" onclick="quickReport(1)">1 Day</div>
                        <div class="nav-tab" onclick="quickReport(7)">7 Days</div>
                        <div class="nav-tab" onclick="quickReport(30)">1 Month</div>
                        <div class="nav-tab" onclick="quickReport(365)">1 Year</div>
                    </div>
                    <!-- Stats -->
                    <div class="stats-grid" style="margin-top: 20px;">
                        <div class="stat-card">
                            <div><div style="color: #888;">Total Revenue</div><h3 id="report-revenue">$0</h3></div>
                        </div>
                    </div>
                </div>

                <!-- PRODUCT REPORT VIEW -->
                <div id="sales-product-view" style="display: none;">
                    <!-- Uber Eats Style Filter Chip for Date Range -->
                     <div class="chip-dropdown" id="chip-prod-range" style="margin-bottom: 20px;">
                        <button class="chip-btn" onclick="toggleChip('prod-range')">
                            <i class="ri-calendar-event-line"></i> <span class="val">Last 7 Days</span> <i class="ri-arrow-down-s-line"></i>
                        </button>
                        <div class="chip-menu" id="menu-prod-range">
                            <!-- Options: 1d, 7d, 1m, 3m, 6m, 1y, Seasons, Custom -->
                            <div class="chip-option" onclick="setProductFilter(1, 'Today')">Today</div>
                            <div class="chip-option" onclick="setProductFilter(7, 'Last 7 Days')">Last 7 Days</div>
                            <div class="chip-option" onclick="setProductFilter(30, 'Last 30 Days')">Last 1 Month</div>
                            <div class="chip-option" onclick="setProductFilter(90, 'Last 3 Months')">Last 3 Months</div>
                            <div class="chip-option" onclick="setProductFilter(365, 'Last Year')">Last Year</div>
                            <div style="height:1px; background:#eee; margin:5px 0;"></div>
                            <div style="font-size:11px; color:#aaa; padding:5px;">Seasons</div>
                            <div class="chip-option" onclick="setProductFilter('Spring', 'Spring')">Spring</div>
                            <div class="chip-option" onclick="setProductFilter('Summer', 'Summer')">Summer</div>
                            <div class="chip-option" onclick="setProductFilter('Autumn', 'Autumn')">Autumn</div>
                            <div class="chip-option" onclick="setProductFilter('Winter', 'Winter')">Winter</div>
                        </div>
                    </div>

                    <div class="data-table">
                        <div class="list-row list-header">
                            <span style="flex:2">Product Name</span>
                            <span style="flex:1">Qty Sold</span>
                            <span style="flex:1; text-align:right;">Total Sales</span>
                        </div>
                        <div id="product-list"></div>
                    </div>
                </div>
            </div>

            <!-- SECTION 4: USERS MANAGEMENT -->
            <div id="users" class="content-section">
                <div class="section-title"><i class="ri-group-line"></i> Users Management</div>
                
                <div class="nav-tabs">
                    <div class="nav-tab active-tab" onclick="switchUserTab('staff', this)">Staff</div>
                    <div class="nav-tab" onclick="switchUserTab('admin', this)">Admins</div>
                </div>

                <div class="data-table">
                    <div class="list-row list-header" id="users-header">
                        <span style="flex:1">Username</span>
                        <span style="flex:1; text-align:right;">Actions</span>
                    </div>
                    <div id="users-list"></div>
                </div>
            </div>

            <!-- SECTION 5: REVIEWS -->
            <div id="reviews" class="content-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="section-title" style="margin:0;"><i class="ri-star-smile-line"></i> Customer Reviews</div>
                    
                    <!-- Review Settings Toggle -->
                    <div style="display: flex; gap: 15px;">
                        <div class="chip-dropdown">
                            <button class="chip-btn" id="notif-btn" onclick="toggleNotifSetting()">
                                <i class="ri-notification-3-line"></i> Notif: <span id="notif-state">OFF</span>
                            </button>
                        </div>
                        <div class="chip-dropdown">
                            <button class="chip-btn" id="sound-btn" onclick="toggleSoundSetting()" style="display:none;">
                                <i class="ri-volume-up-line"></i> Sound: <span id="sound-state">ON</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div id="reviews-container"></div>
            </div>
            
            <!-- SECTION 6: MESSAGES -->
            <div id="messages" class="content-section">
                 <div class="section-title">Messages</div>
                 <div id="messages-container" class="data-table"></div>
            </div>

        </main>
    </div>

    <!-- PROFILE MODAL -->
    <div class="modal-overlay" id="profile-modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">Edit Profile</h3>
            <div class="form-group">
                <label>New Username</label>
                <input type="text" id="edit-self-user" class="form-control">
            </div>
            <div class="form-group">
                <label>New Password</label>
                <input type="text" id="edit-self-pass" class="form-control" placeholder="Letters & numbers">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn-add" id="save-profile-btn" style="flex:1;">Save</button>
                <button class="btn-add" onclick="document.getElementById('profile-modal').style.display='none'" style="flex:1; background:#eee; color:#333;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- AUDIO FOR NOTIFICATION -->
    <audio id="notif-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>

    <script src="admin.js"></script>
</body>
</html>
